function InitVariousPolyfill() { Date.now || (Date.now = function () { return (new Date).getTime() }); typeof String.prototype.trim != "function" && (String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, "") }); g_historyAPISupported = !!(window.history && window.history.pushState) } function isAnchorToSameDiseaseForSamePage(n, t) { var i = URI(), r = URI(t), u = i.query(!0).JournalID, f = i.query(!0).DiseaseID, e = r.query(!0).DiseaseID, o = i.filename(), s = r.filename(); return u === undefined && f === e && o.toLowerCase() === s.toLowerCase() } function scrollToDiv(n) { var t = n, i = $(t).offset(), r = i.top; OPMWidget.initScrollEvent(!1); $("html, body").stop().animate({ scrollTop: r }, 500, function () { changeHash(g_currentPageWithParam, n); OPMWidget.initScrollEvent(!0) }) } function changeHash(n, t) { g_historyAPISupported && history.replaceState(null, null, n + t) } function isInViewableSection(n, t) { if ($(".active-item").length > 0) { var r = $(".left_menu"), u = r.height(), e = r.scrollTop(), h = e + u, i = $(n).offset().top - r.offset().top, f = i + $(n).height(), o = i >= 0 && f <= u, s = (i < 0 && f > 0 || i > 0 && i <= r.height()) && t; return o || s } return !0 } function scrollToActiveItem() { var n = $("#divLeftmenuItem"), t = $(".active-item"); n.scrollTop(t.offset().top - n.offset().top + n.scrollTop()) } var g_currentPageWithParam, g_historyAPISupported, OPMWidget; $(document).ready(function () { g_currentPageWithParam = window.location.href.replace(window.location.hash, "").substring(window.location.href.lastIndexOf("/") + 1); InitVariousPolyfill(); OPMWidget.init(Config_ContentPage) }); OPMWidget = function () { function e() { var n = $("#MainContents05 li").filter(function () { return $(this).html().match(/^処方例[：:](.*?)/g) }), i = { Prescription: { Listing: [] } }; n.length > 0 && ($.each(n, function (n, t) { var u = $(t).html().replace(/<.[^>]*>/g, "").split("処方例")[1].substring(1), r = { title: u, anchor: "prescription_anchor_" + n }; i.Prescription.Listing.push(r); $(t).attr("id", r.anchor).addClass("anchor-prescription") }), f(t.Template_PrescriptionList, t.Frame_PrescriptionList, i)); $(".left_menu").on("click", ".target-anchor-prescription", function (n) { var t = $(this).attr("href"), i = t.substring(t.indexOf("#")); n.preventDefault(); scrollToDiv(i) }) } function i(n) { var i = $("#divLeftmenuItem a"), r = n.replace("#", ""), t; r.indexOf("ID08") >= 0 ? (i.removeClass("active-item").filter('[href*="#ID08"]').addClass("active-item"), isInViewableSection(".active-item", !1) || scrollToActiveItem()) : (t = i.removeClass("active-item").filter('[href*="#' + r + '"]'), t.hasClass("hidden") ? t.closest("ul").siblings(".onepage-nav-to-firstchild").addClass("active-item") : t.addClass("active-item"), isInViewableSection(".active-item", !1) || scrollToActiveItem()) } function o() { $('a[href^="ContentPage.aspx"]').click(function (t) { var r = $(this).attr("href"), u; n.isNoteExpanded == !0 && $(this).trigger(n.customEvent.eHiddenDiseaseNote); r.indexOf("JournalID") == -1 && (r.indexOf("#") >= 0 ? isAnchorToSameDiseaseForSamePage(g_currentPageWithParam, r) && (t.preventDefault(), u = r.substring(r.indexOf("#")), scrollToDiv(u), i(u)) : $(this).hasClass("onepage-nav-to-firstchild") && (t.preventDefault(), $(this).siblings("ul").find("li:first-of-type a").click(), $(this).addClass("active-item"), scrollToActiveItem())) }); $(".anchor-link").click(function (n) { n.preventDefault(); var t = $(this).attr("href"), i = t.substring(t.indexOf("#")); scrollToDiv(i) }) } function s() { var n = $("#phContentNotes-placeholder"), t; $("#phContentNotes-container").insertBefore(n); n = $("#phCOI-placeholder"); $("#phCOI-container").insertBefore(n); n = $("#phMedicalsafety-placeholder"); $("#phMedicalsafety-container").insertBefore(n); n = $("#phHistoryText-placeholder"); $("#phHistoryText-container").insertBefore(n); n = $("#phCaseSearch-placeholder"); $("#phCaseSearch-container").insertBefore(n); $(".left_menu .content").height($(window).height() - 150); t = URI(); t.filename().toLowerCase().indexOf("situationdetails.aspx") >= 0 ? ($(".nav-situation-highlighter").addClass("active-item").closest("li").siblings().find(".active-item").removeClass("active-item"), setTimeout(function () { $(".nav-situation-highlighter").siblings(".treeIcon").click(); scrollToActiveItem() }, 500)) : t.filename().toLowerCase().indexOf("imagetab.aspx") >= 0 && ($(".nav-image-highlighter").addClass("active-item").closest("li").siblings().find(".active-item").removeClass("active-item"), setTimeout(scrollToActiveItem(), 500)) } function r() { $(".onepagestructure-container").on("mouseenter", n.yakuriPopoverHandlerClassName, function () { $(this).trigger(n.customEvent.ePopoverYakuri) }); $(".onepagestructure-container").on(n.customEvent.ePopoverYakuri, function () { var i = $(event.target).attr("data-drug-jpc"), r = t.TimeStamp_YakuriTable, n = Date.now() / 1e3; n - r > 2 && (t.TimeStamp_YakuriTable = n, OPMWidget.populateYakuriTable(i, $(event.target))) }) } function h(t) { t.popover({ html: !0, trigger: "manual", content: function () { return $("#yakuri-table").html() }, title: function () { var n = $(this).html(), t = $(this).attr("href"); return '<a href="' + t + '"">＞＞' + n + 'の薬剤詳細ページを見る<span class="popover-dismiss-yakuri">&#10006;<\/span><\/a>' } }).on("shown.bs.popover", function () { var i = $(this); $(this).next(".popover").find(".popover-dismiss-yakuri").click(function () { i.popover("destroy") }); $(document).keyup(function (n) { n.keyCode == 27 && i.popover("destroy") }); i.next(".popover").mouseleave(function () { i.popover("destroy") }); t.mouseleave(function () { i.next(".popover").is(":hover") || i.popover("destroy") }); $(".onepagestructure-container").off(n.customEvent.ePopoverYakuri) }).on("hidden.bs.popover", function () { r() }); t.popover("show") } function c() { $(".onepage-note-expand").click(function (t) { t.preventDefault(); $(".onepage-note-full").show(); $(".onepage-note-short").hide(); $("#phDiseaseNotes-placeholder").siblings().hide(); var i = $(".titlecol .titlecoltext").text(); $(".titlecol .titlecoltext").text(i + "：施設コンテンツ"); n.isNoteExpanded = !0 }); $(".onepage-note-back").click(function (t) { t.preventDefault(); $(this).trigger(n.customEvent.eHiddenDiseaseNote) }); $(window).on(n.customEvent.eHiddenDiseaseNote, function () { $(".onepage-note-full").hide(); $(".onepage-note-short").show(); $("#phDiseaseNotes-placeholder").siblings().show(); var t = $(".titlecol .titlecoltext").text(); $(".titlecol .titlecoltext").text(t.replace("：施設コンテンツ", "")); n.isNoteExpanded = !1 }) } function u(n) { n === !1 && $(".onepage-reference-link").each(function () { var i = $(this).html(), r = "", u, t, n; if (i.indexOf("-") >= 0) { for (u = i.split("-"), t = [], n = u[0]; n <= u[1]; n++)t.push(n); for (n = 0; n < t.length; n++)r += " [" + t[n] + "] " + $(this).closest(".onepage-reference-maincontent-container").find(".onepage-reference-journallist td.onepage-reference-journallist-rownum").filter(function () { return $(this).text().split(":")[0].trim() == t[n] }).siblings(".onepage-reference-journallist-title").text().trim() } else r = $(this).closest(".onepage-reference-maincontent-container").find(".onepage-reference-journallist td.onepage-reference-journallist-rownum").filter(function () { return $(this).text().split(":")[0].trim() == i }).siblings(".onepage-reference-journallist-title").text().trim(); $(this).attr("title", r) }); $.each(["div", "li"], function (n, t) { $(t + " > .onepage-reference-link-container").each(function () { $(this).wrap("<sup />") }) }) } function f(n, t, i) { var r, u; return $.ajax({ url: n, success: function (n) { r = n; u = Handlebars.compile(r); $(t).html(_encode(u(i))) } }) } var n, t; return { defaultSettings: { isNoteExpanded: !1, yakuriPopoverHandlerClassName: "a.bs-popover-yakuri", yakuriContentClassName: ".bs-popover-yakuri-content", customEvent: { ePopoverYakuri: "OnePageStructure.PopoverYakuri", eScrollOnePageStructure: "OnePageStructure.MouseScroll", eHiddenDiseaseNote: "Hidden.OnePageStructure.DiseaseNote", eShownDiseaseNote: "Shown.OnePageStructure.DiseaseNote" } }, init: function (i) { if (n = this.defaultSettings, t = i, t.IsPrintPage) u(!0); else { o(); r(); u(!1); c(); s(); e(); var f = _encode(window.location.hash); (f.replace("#", "") === $("#MainContents04 a.header_ancher:first").attr("id") || f.replace("#", "") === $("#MainContents05 a.header_ancher:first").attr("id")) && (console.log(f + " - true"), setTimeout(function () { scrollToDiv(f) }, 500)); OPMWidget.initScrollEvent(!0) } }, populateYakuriTable: function (n, i) { if (n !== "") { var r = { drugJPC: n }; $.ajax({ cache: !1, type: "POST", url: t.URL_DisplayYakuriTable, data: JSON.stringify(r), dataType: "json", contentType: "application/json; charset=utf-8", success: function (n) { if (!n.d.error) { var r = f(t.Template_YakuriTable, t.Frame_YakuriTable, n.d); r.done(function () { h(i) }) } }, error: function (n) { console.log(n) } }) } }, initScrollEvent: function (t) { if (t === !0) { var u = $("a[id^=ID], p[id^=ID], a[id=TOP], a[id=DiseaseAction], a[id=DiseaseEvidence], a[id=GUIDELINE], a[id=CASESEARCH], a[id=REFERENCE], a[id=EXTLINKS]"), r = null; $(window).scroll(function () { r && clearTimeout(r); r = setTimeout(function () { $(window).trigger(n.customEvent.eScrollOnePageStructure) }, 150) }); $(window).on(n.customEvent.eScrollOnePageStructure, function () { var r = $(this).scrollTop() + 106, n = u.map(function () { if ($(this).offset().top < r) return this }), t; n.length > 0 && (n = n[n.length - 1], t = n.id, $.trim(t) !== "" && (i(t), changeHash(g_currentPageWithParam, "#" + t))) }) } else $(window).off(n.customEvent.eScrollOnePageStructure) } } }();


function _encode(str) {
    const el = document.createElement('div');
    el.textContent = str;
    var res = el.innerHTML;
    res = res.replaceAll("&lt;", "<");
    res = res.replaceAll("&gt;", ">");
    res = res.replaceAll("&amp;", "&");
    return res;
}